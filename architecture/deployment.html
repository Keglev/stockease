<!--
================================================================================
                    STOCKEASE ENTERPRISE DOCUMENTATION TEMPLATE
================================================================================

File: enterprise-docs.html
Purpose: 
  Professional HTML template for generating enterprise-grade architecture 
  documentation using Pandoc. Used by the docs-pipeline.yml GitHub Actions
  workflow to convert markdown to styled HTML with sidebar navigation and
  mermaid diagram support.

Template Engine: Pandoc (pandoc.org)
  - Variables: , <h1
id="deployment-infrastructure-architecture">Deployment &amp;
Infrastructure Architecture</h1>
<h2 id="deployment-topology">Deployment Topology</h2>
<div class="mermaid">
graph TB
    subgraph GitHub["GitHub Repository (Keglev/stockease)"]
        MainBranch["main branch<br/>(Source Code)"]
        DocsBranch["docs branch<br/>(GH Pages output)"]
        PRs["Pull Requests<br/>(Reviews)"]
    end
    
    MainBranch -->|Push to origin/main| Actions
    
    subgraph Actions["GitHub Actions (CI/CD Pipelines)"]
        Build["Build & Test Workflow<br/>(auto_deploy.yml)<br/>1. Checkout code<br/>2. Run Maven build<br/>3. Run tests (65+)<br/>4. Build Docker image<br/>5. Push to GHCR<br/>6. Deploy to Koyeb"]
        Docs["Docs Generation Workflow<br/>(docs-ci.yml)<br/>1. Extract OpenAPI spec<br/>2. Convert Markdown â†’ HTML<br/>3. Generate Redoc HTML<br/>4. Collect coverage<br/>5. Commit to docs branch<br/>6. GitHub Pages auto-sync"]
    end
    
    Build -->|GHCR Image<br/>ghcr.io/keglev/...| Koyeb
    Docs -->|Generated HTML<br/>docs branch| Pages
    
    Koyeb["Koyeb<br/>Container Service<br/>(Production)"]
    Pages["GitHub Pages<br/>(docs branch)<br/>https://Keglev..."]
    
    Koyeb -->|JDBC Connection| Neon
    
    Neon["Neon PostgreSQL 17.5<br/>(Serverless Database)<br/>- Auto-backups<br/>- Connection pooling<br/>- Failover support"]
    
    style GitHub fill:#f9f9f9
    style Actions fill:#e3f2fd
    style Koyeb fill:#fff3e0
    style Pages fill:#e8f5e9
    style Neon fill:#fce4ec
</div>
<h2 id="cicd-pipeline-details">CI/CD Pipeline Details</h2>
<h3 id="build-deploy-workflow-auto_deploy.yml">Build &amp; Deploy
Workflow (<code>auto_deploy.yml</code>)</h3>
<p><strong>Trigger Events</strong>: - Push to <code>main</code> branch -
Pull request creation - Manual trigger (workflow_dispatch)</p>
<p><strong>Pipeline Stages</strong>:</p>
<div class="mermaid">
graph TD
    A[Stage 1 - Checkout & Setup] --> B[Stage 2 - Build]
    B --> C[Stage 3 - Test]
    C --> D[Stage 4 - Build Docker Image]
    D --> E[Stage 5 - Push to Container Registry]
    E --> F[Stage 6 - Deploy to Koyeb]
    F --> G[Stage 7 - Verification]
    
    A -->|Details| A1["- Checkout code from GitHub<br/>- Set up JDK 17<br/>- Cache Maven dependencies<br/>- Verify build environment"]
    B -->|Details| B1["- Run Maven clean package<br/>- Compile all Java source code<br/>- Skip tests in this stage<br/>- Generate JAR file"]
    C -->|Details| C1["- Run 65+ unit tests<br/>- Tests use H2 in-memory database<br/>- Generate coverage reports (JaCoCo)<br/>- Fail pipeline if tests don't pass"]
    D -->|Details| D1["- Read Dockerfile from repository<br/>- Build image based on Dockerfile<br/>- Tag as ghcr.io/keglev/stockease latest<br/>- Tag as ghcr.io/keglev/stockease commit-sha<br/>- Generate SBOM"]
    E -->|Details| E1["- Authenticate with GHCR<br/>- Push tagged images to GHCR<br/>- Make images available for deployment<br/>- Store in ghcr.io/keglev/stockease"]
    F -->|Details| F1["- Get Koyeb API token from secrets<br/>- Trigger Koyeb deployment<br/>- Pull latest image from GHCR<br/>- Perform blue-green deployment<br/>- Health checks (retry up to 5 times)<br/>- Rollback if health check fails"]
    G -->|Details| G1["- Verify deployment status<br/>- Check health endpoint /health<br/>- Log deployment results<br/>- Notify on success/failure"]
    
    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style C fill:#e3f2fd
    style D fill:#e3f2fd
    style E fill:#e3f2fd
    style F fill:#e3f2fd
    style G fill:#c8e6c9
</div>
<h3
id="documentation-pipeline-docs-ci.yml---to-be-created">Documentation
Pipeline (<code>docs-ci.yml</code> - TO BE CREATED)</h3>
<p><strong>Trigger Events</strong>: - Push to <code>main</code> when
<code>/backend/docs/</code> changes - Manual trigger</p>
<p><strong>Pipeline Stages</strong>:</p>
<div class="mermaid">
graph TD
    A[Stage 1 - Extract OpenAPI Spec] --> B[Stage 2 - Generate Redoc HTML]
    B --> C[Stage 3 - Convert Markdown to HTML]
    C --> D[Stage 4 - Collect Coverage Reports]
    D --> E[Stage 5 - Commit to Docs Branch]
    E --> F[Stage 6 - Cleanup]
    
    A -->|Details| A1["- Build backend application<br/>- Start Spring Boot server<br/>- Fetch OpenAPI spec from /v3/api-docs<br/>- Validate OpenAPI spec<br/>- Save to docs/api/openapi/openapi.json"]
    B -->|Details| B1["- Install Redoc CLI<br/>- Read OpenAPI spec<br/>- Generate interactive HTML documentation<br/>- Output to docs/api/redoc/index.html<br/>- Optimize for web"]
    C -->|Details| C1["- Install pandoc<br/>- For each .md file in docs/architecture/:<br/>  * Convert to HTML<br/>  * Apply styling<br/>  * Output to docs/architecture/*.html<br/>- Convert docs/index.md to docs/index.html<br/>- Generate table of contents"]
    D -->|Details| D1["- Run Maven test with JaCoCo<br/>- Generate coverage report<br/>- Copy to docs/coverage/<br/>- Generate index.html for coverage dashboard<br/>- Calculate coverage percentage"]
    E -->|Details| E1["- Switch to docs branch<br/>- Remove old generated files<br/>- Copy all new HTML files<br/>- Commit with auto-generated documentation<br/>- Push to origin/docs<br/>- GitHub Pages auto-publishes"]
    F -->|Details| F1["- Remove temporary files<br/>- Clean build artifacts<br/>- Log completion"]
    
    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style C fill:#e3f2fd
    style D fill:#e3f2fd
    style E fill:#e3f2fd
    style F fill:#c8e6c9
</div>
<h2 id="deployment-environments">Deployment Environments</h2>
<h3 id="development-environment">Development Environment</h3>
<ul>
<li><strong>Branch</strong>: Any feature branch</li>
<li><strong>Triggered By</strong>: Manual trigger or PR</li>
<li><strong>Database</strong>: H2 in-memory (testing only)</li>
<li><strong>Deployment</strong>: Skipped</li>
<li><strong>Testing</strong>: Full suite (65+ tests)</li>
</ul>
<h3 id="staging-environment">Staging Environment</h3>
<ul>
<li><strong>Branch</strong>: develop (if used)</li>
<li><strong>Deployment Target</strong>: Separate Koyeb service</li>
<li><strong>Database</strong>: PostgreSQL test instance</li>
<li><strong>Testing</strong>: Full test suite + smoke tests</li>
<li><strong>Duration</strong>: 10-15 minutes</li>
</ul>
<h3 id="production-environment">Production Environment</h3>
<ul>
<li><strong>Branch</strong>: main</li>
<li><strong>Deployment Target</strong>: Koyeb production service</li>
<li><strong>Database</strong>: Neon PostgreSQL (production)</li>
<li><strong>URL</strong>:
https://stockease-backend-production.koyeb.app</li>
<li><strong>Testing</strong>: Full test suite + health checks</li>
<li><strong>Duration</strong>: 3-5 minutes</li>
<li><strong>Rollback</strong>: Automatic if health checks fail</li>
</ul>
<h2 id="koyeb-deployment-configuration">Koyeb Deployment
Configuration</h2>
<h3 id="service-details">Service Details</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Service Name</span><span class="kw">:</span><span class="at"> stockease-backend-production</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Status</span><span class="kw">:</span><span class="at"> HEALTHY</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Runtime</span><span class="kw">:</span><span class="at"> Docker (custom image)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Region</span><span class="kw">:</span><span class="at"> US (Auto)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Replicas</span><span class="kw">:</span><span class="at"> 1-2 (auto-scaling)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Domain</span><span class="kw">:</span><span class="at"> stockease-backend-production.koyeb.app</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Environment Variables</span><span class="kw">:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">SPRING_PROFILES_ACTIVE</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_HOST</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Neon endpoint</span><span class="kw">]</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_PORT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_NAME</span><span class="kw">:</span><span class="at"> stockease</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_USER</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_PASSWORD</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">JWT_SECRET</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">JAVA_OPTS</span><span class="kw">:</span><span class="at"> -Xmx512m -Xms256m</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">Port Mapping</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Container Port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Public Port</span><span class="kw">:</span><span class="at"> 443 (HTTPS)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Protocol</span><span class="kw">:</span><span class="at"> HTTP2</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">Health Check</span><span class="kw">:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Endpoint</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Interval</span><span class="kw">:</span><span class="at"> 30 seconds</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Timeout</span><span class="kw">:</span><span class="at"> 5 seconds</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Consecutive Failures</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Consecutive Successes</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span></code></pre></div>
<h3 id="auto-scaling-configuration">Auto-Scaling Configuration</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Min Replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Max Replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Target CPU</span><span class="kw">:</span><span class="at"> 70%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Target Memory</span><span class="kw">:</span><span class="at"> 80%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Scale Up Delay</span><span class="kw">:</span><span class="at"> 60 seconds</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Scale Down Delay</span><span class="kw">:</span><span class="at"> 300 seconds</span></span></code></pre></div>
<h2 id="database-management-neon-postgresql">Database Management (Neon
PostgreSQL)</h2>
<h3 id="connection-details">Connection Details</h3>
<pre><code>Host: [neon-project].neon.tech
Port: 5432
Database: stockease
SSL Mode: require
Connection Pooling: Enabled (connection limit: 100)</code></pre>
<h3 id="automated-backups">Automated Backups</h3>
<ul>
<li><strong>Frequency</strong>: Automatic daily</li>
<li><strong>Retention</strong>: 7 days</li>
<li><strong>Backup Type</strong>: Full backup</li>
<li><strong>Recovery</strong>: Point-in-time restore available</li>
</ul>
<h3 id="database-migrations-flyway">Database Migrations (Flyway)</h3>
<p><strong>Migration Files</strong> (in
<code>src/main/resources/db/migration/</code>):</p>
<pre><code>V1__init_schema.sql
  â”œâ”€â”€ CREATE TABLE users
  â”‚   â”œâ”€â”€ id (UUID, PK)
  â”‚   â”œâ”€â”€ username (VARCHAR, UNIQUE)
  â”‚   â”œâ”€â”€ password (VARCHAR, BCrypt)
  â”‚   â”œâ”€â”€ role (VARCHAR)
  â”‚   â”œâ”€â”€ created_at (TIMESTAMP)
  â”‚   â””â”€â”€ updated_at (TIMESTAMP)
  â”‚
  â””â”€â”€ CREATE TABLE products
      â”œâ”€â”€ id (UUID, PK)
      â”œâ”€â”€ name (VARCHAR)
      â”œâ”€â”€ description (TEXT)
      â”œâ”€â”€ price (DECIMAL)
      â”œâ”€â”€ quantity (INTEGER)
      â”œâ”€â”€ sku (VARCHAR, UNIQUE)
      â”œâ”€â”€ category (VARCHAR)
      â”œâ”€â”€ created_at (TIMESTAMP)
      â”œâ”€â”€ updated_at (TIMESTAMP)
      â””â”€â”€ created_by (UUID, FK â†’ users)

V2__add_indexes.sql
  â”œâ”€â”€ CREATE INDEX idx_products_sku
  â”œâ”€â”€ CREATE INDEX idx_products_category
  â”œâ”€â”€ CREATE INDEX idx_users_username
  â””â”€â”€ CREATE INDEX idx_products_created_by

V3__seed_data.sql
  â”œâ”€â”€ INSERT admin user (admin/admin123)
  â”œâ”€â”€ INSERT regular user (user/user123)
  â”œâ”€â”€ INSERT sample products
  â””â”€â”€ Uses DB-agnostic existence check for H2 compatibility</code></pre>
<p><strong>Migrations Overview</strong>:</p>
<div class="mermaid">
erDiagram
    users {
        UUID id PK
        VARCHAR username UK
        VARCHAR password
        VARCHAR email UK
        VARCHAR role
        TIMESTAMP created_at
        TIMESTAMP updated_at
    }
    
    products {
        UUID id PK
        VARCHAR name
        TEXT description
        DECIMAL price
        INTEGER quantity
        VARCHAR sku UK
        VARCHAR category
        TIMESTAMP created_at
        TIMESTAMP updated_at
        UUID created_by FK
    }
    
    users ||--o{ products : "creates"
</div>
<p><strong>Migration Files</strong>:</p>
<div class="mermaid">
graph TD
    V1[V1__initial_schema.sql] --> V2[V2__add_indexes.sql]
    V2 --> V3[V3__seed_data.sql]
    
    V1 -->|Creates| V1A["- users table<br/>- products table"]
    V2 -->|Adds| V2A["- idx_products_sku<br/>- idx_products_category<br/>- idx_users_username<br/>- idx_products_created_by"]
    V3 -->|Inserts| V3A["- admin user (admin/admin123)<br/>- regular user (user/user123)<br/>- sample products<br/>- H2 compatibility checks"]
    
    style V1 fill:#e3f2fd
    style V2 fill:#e3f2fd
    style V3 fill:#c8e6c9
</div>
<p><strong>Migration Execution</strong>:</p>
<div class="mermaid">
graph TD
    A[Application Startup] --> B[Spring Boot loads]
    B --> C[Flyway initializes]
    C --> D[Checks flyway_schema_history table]
    D --> E[Identifies new migrations]
    E --> F[Executes migrations in order]
    F --> G[Updates schema version]
    G --> H[Application proceeds with data access]
    
    style A fill:#fff3e0
    style H fill:#c8e6c9
</div>
<pre><code>Application Startup
  â”œâ”€â”€ Spring Boot loads
  â”œâ”€â”€ Flyway initializes
  â”œâ”€â”€ Checks flyway_schema_history table
  â”œâ”€â”€ Identifies new migrations
  â”œâ”€â”€ Executes migrations in order
  â”œâ”€â”€ Updates schema version
  â””â”€â”€ Application proceeds with data access</code></pre>
<h2 id="containerization">Containerization</h2>
<h3 id="dockerfile">Dockerfile</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multi-stage build for optimization</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> eclipse-temurin:17-jdk-alpine <span class="kw">AS</span> builder</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> mvnw .</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> pom.xml .</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> src src</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Build application</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">./mvnw</span> clean package <span class="at">-DskipTests</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Runtime stage</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> eclipse-temurin:17-jre-alpine</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy JAR from builder</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=builder</span> /app/target/stockease-backend-*.jar app.jar</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Health check</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">HEALTHCHECK</span> <span class="op">--interval=30s</span> <span class="op">--timeout=5s</span> <span class="op">--start-period=10s</span> <span class="op">--retries=3</span> \</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CMD</span> <span class="fu">wget</span> <span class="at">--no-verbose</span> <span class="at">--tries</span><span class="op">=</span>1 <span class="at">--spider</span> http://localhost:8080/health <span class="kw">||</span> <span class="bu">exit</span> 1</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Expose port</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8080</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Run application</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;java&quot;</span>, <span class="st">&quot;-jar&quot;</span>, <span class="st">&quot;app.jar&quot;</span>]</span></code></pre></div>
<p><strong>Image Details</strong>: - <strong>Base Image</strong>:
eclipse-temurin:17-jre-alpine (122MB) - <strong>Final Size</strong>:
~350MB (with JAR and dependencies) - <strong>Build Time</strong>: ~2
minutes - <strong>Startup Time</strong>: ~8-10 seconds</p>
<h3 id="image-registry-ghcr">Image Registry (GHCR)</h3>
<pre><code>Registry: ghcr.io/keglev/stockease
Authentication: GitHub PAT (Personal Access Token)

Image Tags:
  - ghcr.io/keglev/stockease:latest (always latest build)
  - ghcr.io/keglev/stockease:v1.0.0 (semantic versioning)
  - ghcr.io/keglev/stockease:sha-abc123 (commit hash)</code></pre>
<h2 id="monitoring-observability">Monitoring &amp; Observability</h2>
<h3 id="health-checks">Health Checks</h3>
<p><strong>Endpoint</strong>: <code>GET /health</code></p>
<p><strong>Response</strong> (when healthy):</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;components&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;db&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;database&quot;</span><span class="fu">:</span> <span class="st">&quot;PostgreSQL&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;validationQuery&quot;</span><span class="fu">:</span> <span class="st">&quot;isValid()&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;diskSpace&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;total&quot;</span><span class="fu">:</span> <span class="dv">10737418240</span><span class="fu">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;free&quot;</span><span class="fu">:</span> <span class="dv">5368709120</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;threshold&quot;</span><span class="fu">:</span> <span class="dv">10485760</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;exists&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Response</strong> (when unhealthy):</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;DOWN&quot;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;components&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;db&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;DOWN&quot;</span><span class="fu">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Connection refused&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="application-logs">Application Logs</h3>
<p><strong>Log Output</strong> (captured by Koyeb):</p>
<pre><code>[2025-10-31 10:30:00] INFO  o.s.b.StartupInfoLogger : Starting StockEaseApplication
[2025-10-31 10:30:01] INFO  o.s.d.r.c.EnableJpaRepositoriesRegistrar : Scanning JPA repositories
[2025-10-31 10:30:02] INFO  o.f.c.internal.license.VersionPrinter : Flyway Community Edition
[2025-10-31 10:30:02] INFO  o.f.c.internal.database.base.DatabaseFactory : Database: PostgreSQL 17.5
[2025-10-31 10:30:02] INFO  o.f.c.i.s.sql.PlaceholderReplacer : Locations: [classpath:db/migration]
[2025-10-31 10:30:02] INFO  o.f.c.i.c.sql.SqlScriptExecutor : Successfully validated 3 migrations
[2025-10-31 10:30:02] INFO  o.f.c.i.c.sql.SqlScriptExecutor : Current version of schema &quot;public&quot;: 3
[2025-10-31 10:30:03] INFO  o.s.s.web.DefaultSecurityFilterChain : Will secure any request
[2025-10-31 10:30:03] INFO  o.s.b.w.e.tomcat.TomcatWebServer : Tomcat started on port(s): 8080
[2025-10-31 10:30:04] INFO  o.s.b.StartupInfoLogger : Started StockEaseApplication in 4.123s</code></pre>
<h3 id="metrics-monitoring">Metrics Monitoring</h3>
<p><strong>Tracked Metrics</strong>: - <strong>Request Count</strong>:
Requests per minute - <strong>Response Time</strong>: Average, P50, P95,
P99 - <strong>Error Rate</strong>: 4xx, 5xx errors - <strong>Database
Connections</strong>: Active, idle, queued - <strong>Memory
Usage</strong>: Heap, non-heap - <strong>CPU Usage</strong>: Container
CPU %</p>
<p><strong>Alerts</strong> (future): - Health check failures (trigger
rollback) - High error rate (&gt;5%) - Slow response times (&gt;500ms
avg) - Memory pressure (&gt;85%) - Database connection pool
exhaustion</p>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<h3 id="backup-strategy">Backup Strategy</h3>
<ul>
<li><strong>Database</strong>: Automated daily backups (Neon)</li>
<li><strong>Code</strong>: Git repository with full history</li>
<li><strong>Configuration</strong>: Environment variables in GitHub
Secrets</li>
<li><strong>Docker Images</strong>: Retained in GHCR</li>
</ul>
<h3 id="recovery-procedures">Recovery Procedures</h3>
<p><strong>If Deployment Fails</strong>: 1. CI pipeline detects failure
2. Health checks fail 3. Koyeb automatically rolls back to previous
version 4. Notification sent to team 5. Review logs for root cause</p>
<p><strong>If Database is Corrupted</strong>: 1. Determine recovery
point from backups 2. Create database restore job 3. Test restore in
staging environment 4. Point Koyeb to restored database 5. Verify
application functionality</p>
<p><strong>If Koyeb Service Goes Down</strong>: 1. Manual trigger of
deployment pipeline 2. Redeploy from latest commit 3. Verify health
checks pass 4. Monitor for stability</p>
<h2 id="performance-tuning">Performance Tuning</h2>
<h3 id="jvm-configuration">JVM Configuration</h3>
<pre><code>-Xmx512m          # Max heap: 512MB
-Xms256m          # Initial heap: 256MB
-XX:+UseG1GC      # G1 garbage collection
-XX:MaxGCPauseMillis=200</code></pre>
<h3 id="database-optimization">Database Optimization</h3>
<pre><code>Connection Pool: HikariCP
Max Connections: 10
Idle Timeout: 600 seconds
Connection Timeout: 30 seconds</code></pre>
<h3 id="caching-future">Caching (Future)</h3>
<ul>
<li>Spring Cache abstraction</li>
<li>Redis for session/data caching</li>
<li>TTL: 1 hour for product data</li>
</ul>
<h2 id="security-in-deployment">Security in Deployment</h2>
<h3 id="secrets-management">Secrets Management</h3>
<pre><code>Environment Variables (GitHub Secrets):
  - DB_PASSWORD
  - JWT_SECRET
  - GITHUB_TOKEN (for deployments)</code></pre>
<p><strong>Never Committed to Repository</strong>: - Database passwords
- API keys - JWT secrets - Personal access tokens</p>
<h3 id="network-security">Network Security</h3>
<ul>
<li>HTTPS/TLS enforced</li>
<li>CORS configured for frontend domain only</li>
<li>WAF rules (via Koyeb/CloudFlare)</li>
<li>DDoS protection enabled</li>
</ul>
<h3 id="image-security">Image Security</h3>
<ul>
<li>No hardcoded secrets in Docker image</li>
<li>Alpine Linux for minimal attack surface</li>
<li>Regular base image updates</li>
<li>SBOM (Software Bill of Materials) generated</li>
</ul>
<h2 id="deployment-checklist">Deployment Checklist</h2>
<p>Before production deployment: - [ ] All tests passing (65+) - [ ]
Code reviewed - [ ] Secrets configured in GitHub - [ ] Database
migrations validated - [ ] Docker image built and tested - [ ] Health
checks verified - [ ] CORS configured correctly - [ ] SSL certificates
valid - [ ] Backups configured - [ ] Monitoring/alerting set up - [ ]
Documentation updated - [ ] Rollback plan prepared</p>
<hr />
<h2 id="related-documentation">Related Documentation</h2>
<h3 id="main-architecture-topics">Main Architecture Topics</h3>
<ul>
<li><strong><a href="./overview.html">Architecture Overview</a></strong>
- Business context and infrastructure decisions</li>
<li><strong><a href="./backend.html">Backend Architecture</a></strong> -
Application structure being deployed</li>
<li><strong><a href="./layers.html">Service Layers</a></strong> -
Layer-level considerations for deployment</li>
<li><strong><a href="./security.html">Security Architecture</a></strong>
- Security requirements for production deployment</li>
</ul>
<h3 id="architecture-decisions-adrs">Architecture Decisions (ADRs)</h3>
<ul>
<li><strong><a href="./decisions/001-database-choice.html">Database
Choice</a></strong> - PostgreSQL for production, H2 for testing</li>
<li><strong><a
href="./decisions/002-validation-strategy.html">Validation
Strategy</a></strong> - Validation in pre-production testing</li>
</ul>
<h3 id="design-patterns-practices">Design Patterns &amp; Practices</h3>
<ul>
<li><strong><a href="./patterns/security-patterns.html">Security
Patterns</a></strong> - HTTPS/TLS, encryption, secure configuration</li>
<li><strong><a href="./patterns/repository-pattern.html">Repository
Pattern</a></strong> - Database connection strategies for
production</li>
</ul>
<h3 id="deployment-details">Deployment Details</h3>
<ul>
<li><strong><a href="./deployment/ci-pipeline.html">CI/CD
Pipeline</a></strong> - GitHub Actions for automated deployments</li>
<li><strong><a href="./deployment/staging-config.html">Staging
Configuration</a></strong> - Pre-production testing and
verification</li>
</ul>
<h3 id="related-frontend-docs">Related Frontend Docs</h3>
<ul>
<li><strong><a href="./frontend.html">Frontend Architecture</a></strong>
- React deployment to Render</li>
</ul>
<hr />
<p><strong>Document Version</strong>: 1.0<br />
<strong>Last Updated</strong>: October 31, 2025<br />
<strong>Status</strong>: Production
Ready</p> are substituted by Pandoc during generation
  - Standalone mode: --standalone flag ensures complete HTML output
  - Template variables documented: https://pandoc.org/MANUAL.html#templates

Key Features:
  âœ“ Responsive two-column layout (sidebar + content)
  âœ“ Professional styling via external enterprise-docs.css
  âœ“ Automatic sidebar navigation with active state highlighting
  âœ“ Mermaid.js v10 integration for architecture diagrams
  âœ“ Table of contents highlighting during scroll
  âœ“ Print-friendly styles
  âœ“ GitHub Pages compatible (absolute paths with /stockease/ root)

Browser Support: All modern browsers (Chrome, Firefox, Safari, Edge)
Accessibility: WCAG 2.1 AA compliant

Dependencies:
  - External CSS: /stockease/templates/enterprise-docs.css
  - Mermaid.js v10: https://cdn.jsdelivr.net/npm/mermaid@10/
  - Pandoc Lua Filter: /tmp/md-to-html-links.lua (converts mermaid blocks to divs)

Generated Files Location:
  - GitHub Pages: https://keglev.github.io/stockease/architecture/
  - Build Output: target/docs/architecture/ (before deployment)

Workflow Integration:
  1. docs-pipeline.yml: Runs Pandoc with this template + Lua filter
  2. Lua Filter: Converts mermaid code blocks to <div class="mermaid">
  3. Pandoc: Processes markdown with this template
  4. Output: Styled HTML in target/docs/architecture/
  5. Deployment: Published to GitHub Pages via gh-pages action

Last Updated: 2025-11-04
Version: 2.0 (CSS refactored to external file, mermaid rendering fixed)
================================================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> - StockEase Architecture Documentation</title>
    <link rel="stylesheet" href="/stockease/templates/enterprise-docs.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="/stockease/index.html" class="logo">ðŸ“š StockEase Architecture Docs</a>
            <nav class="nav-breadcrumb">
                <a href="/stockease/index.html">Home</a> / <span id="breadcrumb">Documentation</span>
            </nav>
        </div>
    </header>

    <div class="container">
        <aside id="sidebar"></aside>
        <main>
            <div class="content">
                <h1
                id="deployment-infrastructure-architecture">Deployment
                &amp; Infrastructure Architecture</h1>
                <h2 id="deployment-topology">Deployment Topology</h2>
                <div class="mermaid">
                graph TB
                    subgraph GitHub["GitHub Repository (Keglev/stockease)"]
                        MainBranch["main branch<br/>(Source Code)"]
                        DocsBranch["docs branch<br/>(GH Pages output)"]
                        PRs["Pull Requests<br/>(Reviews)"]
                    end
                    
                    MainBranch -->|Push to origin/main| Actions
                    
                    subgraph Actions["GitHub Actions (CI/CD Pipelines)"]
                        Build["Build & Test Workflow<br/>(auto_deploy.yml)<br/>1. Checkout code<br/>2. Run Maven build<br/>3. Run tests (65+)<br/>4. Build Docker image<br/>5. Push to GHCR<br/>6. Deploy to Koyeb"]
                        Docs["Docs Generation Workflow<br/>(docs-ci.yml)<br/>1. Extract OpenAPI spec<br/>2. Convert Markdown â†’ HTML<br/>3. Generate Redoc HTML<br/>4. Collect coverage<br/>5. Commit to docs branch<br/>6. GitHub Pages auto-sync"]
                    end
                    
                    Build -->|GHCR Image<br/>ghcr.io/keglev/...| Koyeb
                    Docs -->|Generated HTML<br/>docs branch| Pages
                    
                    Koyeb["Koyeb<br/>Container Service<br/>(Production)"]
                    Pages["GitHub Pages<br/>(docs branch)<br/>https://Keglev..."]
                    
                    Koyeb -->|JDBC Connection| Neon
                    
                    Neon["Neon PostgreSQL 17.5<br/>(Serverless Database)<br/>- Auto-backups<br/>- Connection pooling<br/>- Failover support"]
                    
                    style GitHub fill:#f9f9f9
                    style Actions fill:#e3f2fd
                    style Koyeb fill:#fff3e0
                    style Pages fill:#e8f5e9
                    style Neon fill:#fce4ec
                </div>
                <h2 id="cicd-pipeline-details">CI/CD Pipeline
                Details</h2>
                <h3 id="build-deploy-workflow-auto_deploy.yml">Build
                &amp; Deploy Workflow
                (<code>auto_deploy.yml</code>)</h3>
                <p><strong>Trigger Events</strong>: - Push to
                <code>main</code> branch - Pull request creation -
                Manual trigger (workflow_dispatch)</p>
                <p><strong>Pipeline Stages</strong>:</p>
                <div class="mermaid">
                graph TD
                    A[Stage 1 - Checkout & Setup] --> B[Stage 2 - Build]
                    B --> C[Stage 3 - Test]
                    C --> D[Stage 4 - Build Docker Image]
                    D --> E[Stage 5 - Push to Container Registry]
                    E --> F[Stage 6 - Deploy to Koyeb]
                    F --> G[Stage 7 - Verification]
                    
                    A -->|Details| A1["- Checkout code from GitHub<br/>- Set up JDK 17<br/>- Cache Maven dependencies<br/>- Verify build environment"]
                    B -->|Details| B1["- Run Maven clean package<br/>- Compile all Java source code<br/>- Skip tests in this stage<br/>- Generate JAR file"]
                    C -->|Details| C1["- Run 65+ unit tests<br/>- Tests use H2 in-memory database<br/>- Generate coverage reports (JaCoCo)<br/>- Fail pipeline if tests don't pass"]
                    D -->|Details| D1["- Read Dockerfile from repository<br/>- Build image based on Dockerfile<br/>- Tag as ghcr.io/keglev/stockease latest<br/>- Tag as ghcr.io/keglev/stockease commit-sha<br/>- Generate SBOM"]
                    E -->|Details| E1["- Authenticate with GHCR<br/>- Push tagged images to GHCR<br/>- Make images available for deployment<br/>- Store in ghcr.io/keglev/stockease"]
                    F -->|Details| F1["- Get Koyeb API token from secrets<br/>- Trigger Koyeb deployment<br/>- Pull latest image from GHCR<br/>- Perform blue-green deployment<br/>- Health checks (retry up to 5 times)<br/>- Rollback if health check fails"]
                    G -->|Details| G1["- Verify deployment status<br/>- Check health endpoint /health<br/>- Log deployment results<br/>- Notify on success/failure"]
                    
                    style A fill:#e3f2fd
                    style B fill:#e3f2fd
                    style C fill:#e3f2fd
                    style D fill:#e3f2fd
                    style E fill:#e3f2fd
                    style F fill:#e3f2fd
                    style G fill:#c8e6c9
                </div>
                <h3
                id="documentation-pipeline-docs-ci.yml---to-be-created">Documentation
                Pipeline (<code>docs-ci.yml</code> - TO BE CREATED)</h3>
                <p><strong>Trigger Events</strong>: - Push to
                <code>main</code> when <code>/backend/docs/</code>
                changes - Manual trigger</p>
                <p><strong>Pipeline Stages</strong>:</p>
                <div class="mermaid">
                graph TD
                    A[Stage 1 - Extract OpenAPI Spec] --> B[Stage 2 - Generate Redoc HTML]
                    B --> C[Stage 3 - Convert Markdown to HTML]
                    C --> D[Stage 4 - Collect Coverage Reports]
                    D --> E[Stage 5 - Commit to Docs Branch]
                    E --> F[Stage 6 - Cleanup]
                    
                    A -->|Details| A1["- Build backend application<br/>- Start Spring Boot server<br/>- Fetch OpenAPI spec from /v3/api-docs<br/>- Validate OpenAPI spec<br/>- Save to docs/api/openapi/openapi.json"]
                    B -->|Details| B1["- Install Redoc CLI<br/>- Read OpenAPI spec<br/>- Generate interactive HTML documentation<br/>- Output to docs/api/redoc/index.html<br/>- Optimize for web"]
                    C -->|Details| C1["- Install pandoc<br/>- For each .md file in docs/architecture/:<br/>  * Convert to HTML<br/>  * Apply styling<br/>  * Output to docs/architecture/*.html<br/>- Convert docs/index.md to docs/index.html<br/>- Generate table of contents"]
                    D -->|Details| D1["- Run Maven test with JaCoCo<br/>- Generate coverage report<br/>- Copy to docs/coverage/<br/>- Generate index.html for coverage dashboard<br/>- Calculate coverage percentage"]
                    E -->|Details| E1["- Switch to docs branch<br/>- Remove old generated files<br/>- Copy all new HTML files<br/>- Commit with auto-generated documentation<br/>- Push to origin/docs<br/>- GitHub Pages auto-publishes"]
                    F -->|Details| F1["- Remove temporary files<br/>- Clean build artifacts<br/>- Log completion"]
                    
                    style A fill:#e3f2fd
                    style B fill:#e3f2fd
                    style C fill:#e3f2fd
                    style D fill:#e3f2fd
                    style E fill:#e3f2fd
                    style F fill:#c8e6c9
                </div>
                <h2 id="deployment-environments">Deployment
                Environments</h2>
                <h3 id="development-environment">Development
                Environment</h3>
                <ul>
                <li><strong>Branch</strong>: Any feature branch</li>
                <li><strong>Triggered By</strong>: Manual trigger or
                PR</li>
                <li><strong>Database</strong>: H2 in-memory (testing
                only)</li>
                <li><strong>Deployment</strong>: Skipped</li>
                <li><strong>Testing</strong>: Full suite (65+
                tests)</li>
                </ul>
                <h3 id="staging-environment">Staging Environment</h3>
                <ul>
                <li><strong>Branch</strong>: develop (if used)</li>
                <li><strong>Deployment Target</strong>: Separate Koyeb
                service</li>
                <li><strong>Database</strong>: PostgreSQL test
                instance</li>
                <li><strong>Testing</strong>: Full test suite + smoke
                tests</li>
                <li><strong>Duration</strong>: 10-15 minutes</li>
                </ul>
                <h3 id="production-environment">Production
                Environment</h3>
                <ul>
                <li><strong>Branch</strong>: main</li>
                <li><strong>Deployment Target</strong>: Koyeb production
                service</li>
                <li><strong>Database</strong>: Neon PostgreSQL
                (production)</li>
                <li><strong>URL</strong>:
                https://stockease-backend-production.koyeb.app</li>
                <li><strong>Testing</strong>: Full test suite + health
                checks</li>
                <li><strong>Duration</strong>: 3-5 minutes</li>
                <li><strong>Rollback</strong>: Automatic if health
                checks fail</li>
                </ul>
                <h2 id="koyeb-deployment-configuration">Koyeb Deployment
                Configuration</h2>
                <h3 id="service-details">Service Details</h3>
                <div class="sourceCode" id="cb1"><pre
                class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Service Name</span><span class="kw">:</span><span class="at"> stockease-backend-production</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Status</span><span class="kw">:</span><span class="at"> HEALTHY</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Runtime</span><span class="kw">:</span><span class="at"> Docker (custom image)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Region</span><span class="kw">:</span><span class="at"> US (Auto)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Replicas</span><span class="kw">:</span><span class="at"> 1-2 (auto-scaling)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Domain</span><span class="kw">:</span><span class="at"> stockease-backend-production.koyeb.app</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Environment Variables</span><span class="kw">:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">SPRING_PROFILES_ACTIVE</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_HOST</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Neon endpoint</span><span class="kw">]</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_PORT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_NAME</span><span class="kw">:</span><span class="at"> stockease</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_USER</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">DB_PASSWORD</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">JWT_SECRET</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">from secrets</span><span class="kw">]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">JAVA_OPTS</span><span class="kw">:</span><span class="at"> -Xmx512m -Xms256m</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">Port Mapping</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Container Port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Public Port</span><span class="kw">:</span><span class="at"> 443 (HTTPS)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Protocol</span><span class="kw">:</span><span class="at"> HTTP2</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">Health Check</span><span class="kw">:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Endpoint</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Interval</span><span class="kw">:</span><span class="at"> 30 seconds</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Timeout</span><span class="kw">:</span><span class="at"> 5 seconds</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Consecutive Failures</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Consecutive Successes</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span></code></pre></div>
                <h3 id="auto-scaling-configuration">Auto-Scaling
                Configuration</h3>
                <div class="sourceCode" id="cb2"><pre
                class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Min Replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Max Replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Target CPU</span><span class="kw">:</span><span class="at"> 70%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Target Memory</span><span class="kw">:</span><span class="at"> 80%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Scale Up Delay</span><span class="kw">:</span><span class="at"> 60 seconds</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Scale Down Delay</span><span class="kw">:</span><span class="at"> 300 seconds</span></span></code></pre></div>
                <h2 id="database-management-neon-postgresql">Database
                Management (Neon PostgreSQL)</h2>
                <h3 id="connection-details">Connection Details</h3>
                <pre><code>Host: [neon-project].neon.tech
Port: 5432
Database: stockease
SSL Mode: require
Connection Pooling: Enabled (connection limit: 100)</code></pre>
                <h3 id="automated-backups">Automated Backups</h3>
                <ul>
                <li><strong>Frequency</strong>: Automatic daily</li>
                <li><strong>Retention</strong>: 7 days</li>
                <li><strong>Backup Type</strong>: Full backup</li>
                <li><strong>Recovery</strong>: Point-in-time restore
                available</li>
                </ul>
                <h3 id="database-migrations-flyway">Database Migrations
                (Flyway)</h3>
                <p><strong>Migration Files</strong> (in
                <code>src/main/resources/db/migration/</code>):</p>
                <pre><code>V1__init_schema.sql
  â”œâ”€â”€ CREATE TABLE users
  â”‚   â”œâ”€â”€ id (UUID, PK)
  â”‚   â”œâ”€â”€ username (VARCHAR, UNIQUE)
  â”‚   â”œâ”€â”€ password (VARCHAR, BCrypt)
  â”‚   â”œâ”€â”€ role (VARCHAR)
  â”‚   â”œâ”€â”€ created_at (TIMESTAMP)
  â”‚   â””â”€â”€ updated_at (TIMESTAMP)
  â”‚
  â””â”€â”€ CREATE TABLE products
      â”œâ”€â”€ id (UUID, PK)
      â”œâ”€â”€ name (VARCHAR)
      â”œâ”€â”€ description (TEXT)
      â”œâ”€â”€ price (DECIMAL)
      â”œâ”€â”€ quantity (INTEGER)
      â”œâ”€â”€ sku (VARCHAR, UNIQUE)
      â”œâ”€â”€ category (VARCHAR)
      â”œâ”€â”€ created_at (TIMESTAMP)
      â”œâ”€â”€ updated_at (TIMESTAMP)
      â””â”€â”€ created_by (UUID, FK â†’ users)

V2__add_indexes.sql
  â”œâ”€â”€ CREATE INDEX idx_products_sku
  â”œâ”€â”€ CREATE INDEX idx_products_category
  â”œâ”€â”€ CREATE INDEX idx_users_username
  â””â”€â”€ CREATE INDEX idx_products_created_by

V3__seed_data.sql
  â”œâ”€â”€ INSERT admin user (admin/admin123)
  â”œâ”€â”€ INSERT regular user (user/user123)
  â”œâ”€â”€ INSERT sample products
  â””â”€â”€ Uses DB-agnostic existence check for H2 compatibility</code></pre>
                <p><strong>Migrations Overview</strong>:</p>
                <div class="mermaid">
                erDiagram
                    users {
                        UUID id PK
                        VARCHAR username UK
                        VARCHAR password
                        VARCHAR email UK
                        VARCHAR role
                        TIMESTAMP created_at
                        TIMESTAMP updated_at
                    }
                    
                    products {
                        UUID id PK
                        VARCHAR name
                        TEXT description
                        DECIMAL price
                        INTEGER quantity
                        VARCHAR sku UK
                        VARCHAR category
                        TIMESTAMP created_at
                        TIMESTAMP updated_at
                        UUID created_by FK
                    }
                    
                    users ||--o{ products : "creates"
                </div>
                <p><strong>Migration Files</strong>:</p>
                <div class="mermaid">
                graph TD
                    V1[V1__initial_schema.sql] --> V2[V2__add_indexes.sql]
                    V2 --> V3[V3__seed_data.sql]
                    
                    V1 -->|Creates| V1A["- users table<br/>- products table"]
                    V2 -->|Adds| V2A["- idx_products_sku<br/>- idx_products_category<br/>- idx_users_username<br/>- idx_products_created_by"]
                    V3 -->|Inserts| V3A["- admin user (admin/admin123)<br/>- regular user (user/user123)<br/>- sample products<br/>- H2 compatibility checks"]
                    
                    style V1 fill:#e3f2fd
                    style V2 fill:#e3f2fd
                    style V3 fill:#c8e6c9
                </div>
                <p><strong>Migration Execution</strong>:</p>
                <div class="mermaid">
                graph TD
                    A[Application Startup] --> B[Spring Boot loads]
                    B --> C[Flyway initializes]
                    C --> D[Checks flyway_schema_history table]
                    D --> E[Identifies new migrations]
                    E --> F[Executes migrations in order]
                    F --> G[Updates schema version]
                    G --> H[Application proceeds with data access]
                    
                    style A fill:#fff3e0
                    style H fill:#c8e6c9
                </div>
                <pre><code>Application Startup
  â”œâ”€â”€ Spring Boot loads
  â”œâ”€â”€ Flyway initializes
  â”œâ”€â”€ Checks flyway_schema_history table
  â”œâ”€â”€ Identifies new migrations
  â”œâ”€â”€ Executes migrations in order
  â”œâ”€â”€ Updates schema version
  â””â”€â”€ Application proceeds with data access</code></pre>
                <h2 id="containerization">Containerization</h2>
                <h3 id="dockerfile">Dockerfile</h3>
                <div class="sourceCode" id="cb6"><pre
                class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multi-stage build for optimization</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> eclipse-temurin:17-jdk-alpine <span class="kw">AS</span> builder</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> mvnw .</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> pom.xml .</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> src src</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Build application</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">./mvnw</span> clean package <span class="at">-DskipTests</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Runtime stage</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> eclipse-temurin:17-jre-alpine</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy JAR from builder</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=builder</span> /app/target/stockease-backend-*.jar app.jar</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Health check</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">HEALTHCHECK</span> <span class="op">--interval=30s</span> <span class="op">--timeout=5s</span> <span class="op">--start-period=10s</span> <span class="op">--retries=3</span> \</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CMD</span> <span class="fu">wget</span> <span class="at">--no-verbose</span> <span class="at">--tries</span><span class="op">=</span>1 <span class="at">--spider</span> http://localhost:8080/health <span class="kw">||</span> <span class="bu">exit</span> 1</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Expose port</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8080</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Run application</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;java&quot;</span>, <span class="st">&quot;-jar&quot;</span>, <span class="st">&quot;app.jar&quot;</span>]</span></code></pre></div>
                <p><strong>Image Details</strong>: - <strong>Base
                Image</strong>: eclipse-temurin:17-jre-alpine (122MB) -
                <strong>Final Size</strong>: ~350MB (with JAR and
                dependencies) - <strong>Build Time</strong>: ~2 minutes
                - <strong>Startup Time</strong>: ~8-10 seconds</p>
                <h3 id="image-registry-ghcr">Image Registry (GHCR)</h3>
                <pre><code>Registry: ghcr.io/keglev/stockease
Authentication: GitHub PAT (Personal Access Token)

Image Tags:
  - ghcr.io/keglev/stockease:latest (always latest build)
  - ghcr.io/keglev/stockease:v1.0.0 (semantic versioning)
  - ghcr.io/keglev/stockease:sha-abc123 (commit hash)</code></pre>
                <h2 id="monitoring-observability">Monitoring &amp;
                Observability</h2>
                <h3 id="health-checks">Health Checks</h3>
                <p><strong>Endpoint</strong>:
                <code>GET /health</code></p>
                <p><strong>Response</strong> (when healthy):</p>
                <div class="sourceCode" id="cb8"><pre
                class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;components&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;db&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;database&quot;</span><span class="fu">:</span> <span class="st">&quot;PostgreSQL&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;validationQuery&quot;</span><span class="fu">:</span> <span class="st">&quot;isValid()&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;diskSpace&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;UP&quot;</span><span class="fu">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;total&quot;</span><span class="fu">:</span> <span class="dv">10737418240</span><span class="fu">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;free&quot;</span><span class="fu">:</span> <span class="dv">5368709120</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;threshold&quot;</span><span class="fu">:</span> <span class="dv">10485760</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;exists&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
                <p><strong>Response</strong> (when unhealthy):</p>
                <div class="sourceCode" id="cb9"><pre
                class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;DOWN&quot;</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;components&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;db&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;DOWN&quot;</span><span class="fu">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;details&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Connection refused&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
                <h3 id="application-logs">Application Logs</h3>
                <p><strong>Log Output</strong> (captured by Koyeb):</p>
                <pre><code>[2025-10-31 10:30:00] INFO  o.s.b.StartupInfoLogger : Starting StockEaseApplication
[2025-10-31 10:30:01] INFO  o.s.d.r.c.EnableJpaRepositoriesRegistrar : Scanning JPA repositories
[2025-10-31 10:30:02] INFO  o.f.c.internal.license.VersionPrinter : Flyway Community Edition
[2025-10-31 10:30:02] INFO  o.f.c.internal.database.base.DatabaseFactory : Database: PostgreSQL 17.5
[2025-10-31 10:30:02] INFO  o.f.c.i.s.sql.PlaceholderReplacer : Locations: [classpath:db/migration]
[2025-10-31 10:30:02] INFO  o.f.c.i.c.sql.SqlScriptExecutor : Successfully validated 3 migrations
[2025-10-31 10:30:02] INFO  o.f.c.i.c.sql.SqlScriptExecutor : Current version of schema &quot;public&quot;: 3
[2025-10-31 10:30:03] INFO  o.s.s.web.DefaultSecurityFilterChain : Will secure any request
[2025-10-31 10:30:03] INFO  o.s.b.w.e.tomcat.TomcatWebServer : Tomcat started on port(s): 8080
[2025-10-31 10:30:04] INFO  o.s.b.StartupInfoLogger : Started StockEaseApplication in 4.123s</code></pre>
                <h3 id="metrics-monitoring">Metrics Monitoring</h3>
                <p><strong>Tracked Metrics</strong>: - <strong>Request
                Count</strong>: Requests per minute - <strong>Response
                Time</strong>: Average, P50, P95, P99 - <strong>Error
                Rate</strong>: 4xx, 5xx errors - <strong>Database
                Connections</strong>: Active, idle, queued -
                <strong>Memory Usage</strong>: Heap, non-heap -
                <strong>CPU Usage</strong>: Container CPU %</p>
                <p><strong>Alerts</strong> (future): - Health check
                failures (trigger rollback) - High error rate (&gt;5%) -
                Slow response times (&gt;500ms avg) - Memory pressure
                (&gt;85%) - Database connection pool exhaustion</p>
                <h2 id="disaster-recovery">Disaster Recovery</h2>
                <h3 id="backup-strategy">Backup Strategy</h3>
                <ul>
                <li><strong>Database</strong>: Automated daily backups
                (Neon)</li>
                <li><strong>Code</strong>: Git repository with full
                history</li>
                <li><strong>Configuration</strong>: Environment
                variables in GitHub Secrets</li>
                <li><strong>Docker Images</strong>: Retained in
                GHCR</li>
                </ul>
                <h3 id="recovery-procedures">Recovery Procedures</h3>
                <p><strong>If Deployment Fails</strong>: 1. CI pipeline
                detects failure 2. Health checks fail 3. Koyeb
                automatically rolls back to previous version 4.
                Notification sent to team 5. Review logs for root
                cause</p>
                <p><strong>If Database is Corrupted</strong>: 1.
                Determine recovery point from backups 2. Create database
                restore job 3. Test restore in staging environment 4.
                Point Koyeb to restored database 5. Verify application
                functionality</p>
                <p><strong>If Koyeb Service Goes Down</strong>: 1.
                Manual trigger of deployment pipeline 2. Redeploy from
                latest commit 3. Verify health checks pass 4. Monitor
                for stability</p>
                <h2 id="performance-tuning">Performance Tuning</h2>
                <h3 id="jvm-configuration">JVM Configuration</h3>
                <pre><code>-Xmx512m          # Max heap: 512MB
-Xms256m          # Initial heap: 256MB
-XX:+UseG1GC      # G1 garbage collection
-XX:MaxGCPauseMillis=200</code></pre>
                <h3 id="database-optimization">Database
                Optimization</h3>
                <pre><code>Connection Pool: HikariCP
Max Connections: 10
Idle Timeout: 600 seconds
Connection Timeout: 30 seconds</code></pre>
                <h3 id="caching-future">Caching (Future)</h3>
                <ul>
                <li>Spring Cache abstraction</li>
                <li>Redis for session/data caching</li>
                <li>TTL: 1 hour for product data</li>
                </ul>
                <h2 id="security-in-deployment">Security in
                Deployment</h2>
                <h3 id="secrets-management">Secrets Management</h3>
                <pre><code>Environment Variables (GitHub Secrets):
  - DB_PASSWORD
  - JWT_SECRET
  - GITHUB_TOKEN (for deployments)</code></pre>
                <p><strong>Never Committed to Repository</strong>: -
                Database passwords - API keys - JWT secrets - Personal
                access tokens</p>
                <h3 id="network-security">Network Security</h3>
                <ul>
                <li>HTTPS/TLS enforced</li>
                <li>CORS configured for frontend domain only</li>
                <li>WAF rules (via Koyeb/CloudFlare)</li>
                <li>DDoS protection enabled</li>
                </ul>
                <h3 id="image-security">Image Security</h3>
                <ul>
                <li>No hardcoded secrets in Docker image</li>
                <li>Alpine Linux for minimal attack surface</li>
                <li>Regular base image updates</li>
                <li>SBOM (Software Bill of Materials) generated</li>
                </ul>
                <h2 id="deployment-checklist">Deployment Checklist</h2>
                <p>Before production deployment: - [ ] All tests passing
                (65+) - [ ] Code reviewed - [ ] Secrets configured in
                GitHub - [ ] Database migrations validated - [ ] Docker
                image built and tested - [ ] Health checks verified - [
                ] CORS configured correctly - [ ] SSL certificates valid
                - [ ] Backups configured - [ ] Monitoring/alerting set
                up - [ ] Documentation updated - [ ] Rollback plan
                prepared</p>
                <hr />
                <h2 id="related-documentation">Related
                Documentation</h2>
                <h3 id="main-architecture-topics">Main Architecture
                Topics</h3>
                <ul>
                <li><strong><a href="./overview.html">Architecture
                Overview</a></strong> - Business context and
                infrastructure decisions</li>
                <li><strong><a href="./backend.html">Backend
                Architecture</a></strong> - Application structure being
                deployed</li>
                <li><strong><a href="./layers.html">Service
                Layers</a></strong> - Layer-level considerations for
                deployment</li>
                <li><strong><a href="./security.html">Security
                Architecture</a></strong> - Security requirements for
                production deployment</li>
                </ul>
                <h3 id="architecture-decisions-adrs">Architecture
                Decisions (ADRs)</h3>
                <ul>
                <li><strong><a
                href="./decisions/001-database-choice.html">Database
                Choice</a></strong> - PostgreSQL for production, H2 for
                testing</li>
                <li><strong><a
                href="./decisions/002-validation-strategy.html">Validation
                Strategy</a></strong> - Validation in pre-production
                testing</li>
                </ul>
                <h3 id="design-patterns-practices">Design Patterns &amp;
                Practices</h3>
                <ul>
                <li><strong><a
                href="./patterns/security-patterns.html">Security
                Patterns</a></strong> - HTTPS/TLS, encryption, secure
                configuration</li>
                <li><strong><a
                href="./patterns/repository-pattern.html">Repository
                Pattern</a></strong> - Database connection strategies
                for production</li>
                </ul>
                <h3 id="deployment-details">Deployment Details</h3>
                <ul>
                <li><strong><a
                href="./deployment/ci-pipeline.html">CI/CD
                Pipeline</a></strong> - GitHub Actions for automated
                deployments</li>
                <li><strong><a
                href="./deployment/staging-config.html">Staging
                Configuration</a></strong> - Pre-production testing and
                verification</li>
                </ul>
                <h3 id="related-frontend-docs">Related Frontend
                Docs</h3>
                <ul>
                <li><strong><a href="./frontend.html">Frontend
                Architecture</a></strong> - React deployment to
                Render</li>
                </ul>
                <hr />
                <p><strong>Document Version</strong>: 1.0<br />
                <strong>Last Updated</strong>: October 31, 2025<br />
                <strong>Status</strong>: Production Ready</p>
            </div>
        </main>
    </div>

    <footer>
        <div class="footer-content">
            <p><strong>StockEase</strong> - Inventory Management System</p>
            <p>Architecture Documentation | Generated with Enterprise Standards</p>
            <p style="opacity: 0.7; font-size: 0.85rem;">Â© 2025 Team StockEase. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function getArchRoot() {
            const path = window.location.pathname;
            const segments = path.split('/').filter(s => s);
            
            // Find how many levels deep we are from 'architecture' folder
            const archIndex = segments.indexOf('architecture');
            if (archIndex === -1) return './';
            
            const depth = segments.length - archIndex - 2; // -2 for architecture and filename
            if (depth <= 0) return './';
            
            return '../'.repeat(depth);
        }

        // Navigation Menu (paths relative to architecture root)
        const navigation = {
            'API Documentation': [
                { label: 'Overview', href: 'api-docs.html', isApiDoc: true },
            ],
            'Architecture': [
                { label: 'Overview', href: 'overview.html' },
                { label: 'System Layers', href: 'layers.html' },
                { label: 'Backend Architecture', href: 'backend.html' },
                { label: 'Frontend Architecture', href: 'frontend.html' },
                { label: 'Security Architecture', href: 'security.html' },
                { label: 'Deployment Strategy', href: 'deployment.html' },
            ],
            'Design Decisions': [
                { label: 'Index', href: 'decisions/index.html' },
            ],
            'Components': [
                { label: 'Index', href: 'components/index.html' },
                { label: 'Analytics Service', href: 'components/analytics-service.html' },
                { label: 'Supplier Controller', href: 'components/supplier-controller.html' },
            ],
            'Patterns': [
                { label: 'Index', href: 'patterns/index.html' },
                { label: 'Repository Pattern', href: 'patterns/repository-pattern.html' },
                { label: 'Security Patterns', href: 'patterns/security-patterns.html' },
            ],
            'Testing': [
                { label: 'Architecture', href: 'testing-architecture.html' },
                { label: 'Test Pyramid', href: 'testing/pyramid.html' },
                { label: 'Strategy', href: 'testing/strategy.html' },
                { label: 'Spring Slices', href: 'testing/spring-slices.html' },
                { label: 'Test Data Fixtures', href: 'testing/test-data-fixtures.html' },
                { label: 'Security Tests', href: 'testing/security-tests.html' },
                { label: 'Naming Conventions', href: 'testing/naming-conventions.html' },
                { label: 'Test Matrix', href: 'testing/matrix.html' },
                { label: 'Coverage & Quality', href: 'testing/coverage-and-quality.html' },
                { label: 'Controller Integration', href: 'testing/controller-integration.html' },
                { label: 'CI Pipeline Tests', href: 'testing/ci-pipeline-tests.html' },
            ],
            'Deployment': [
                { label: 'Overview', href: 'deployment.html' },
                { label: 'CI/CD Pipeline', href: 'deployment/ci-pipeline.html' },
                { label: 'Docker Strategy', href: 'deployment/docker-strategy.html' },
                { label: 'Staging Config', href: 'deployment/staging-config.html' },
            ],
            'Reference': [
                { label: 'Documentation Guide', href: 'DOCUMENTATION-GUIDE.html' },
                { label: 'HTML Generation', href: 'DOCUMENTATION-GENERATION.html' },
                { label: 'Redundancy Analysis', href: 'REDUNDANCY-ANALYSIS.html' },
            ],
        };

        // Build sidebar
        function buildSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (!sidebar) return;

            const archRoot = getArchRoot();

            Object.entries(navigation).forEach(([section, links]) => {
                const navSection = document.createElement('div');
                navSection.className = 'nav-section';

                const title = document.createElement('div');
                title.className = 'nav-section-title';
                title.textContent = section;
                navSection.appendChild(title);

                const ul = document.createElement('ul');
                links.forEach(link => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    
                    // For API docs, go up to docs root; otherwise use architecture root
                    if (link.isApiDoc) {
                        a.href = archRoot + '../' + link.href;
                    } else {
                        a.href = archRoot + link.href;
                    }
                    
                    a.textContent = link.label;

                    // Highlight current page
                    const currentPath = window.location.pathname;
                    const linkPath = link.href.replace('.html', '');
                    if (currentPath.endsWith(link.href) || currentPath.includes(linkPath)) {
                        a.className = 'active';
                    }

                    li.appendChild(a);
                    ul.appendChild(li);
                });

                navSection.appendChild(ul);
                sidebar.appendChild(navSection);
            });
        }

        // Build table of contents highlight
        function initTableOfContents() {
            const tocLinks = document.querySelectorAll('nav.toc a');
            const headings = document.querySelectorAll('h2, h3');

            window.addEventListener('scroll', () => {
                let currentHeading = null;
                headings.forEach(heading => {
                    if (heading.getBoundingClientRect().top <= 100) {
                        currentHeading = heading;
                    }
                });

                tocLinks.forEach(link => {
                    link.classList.remove('active');
                    if (currentHeading) {
                        const href = link.getAttribute('href');
                        if (href === '#' + currentHeading.id) {
                            link.classList.add('active');
                        }
                    }
                });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            buildSidebar();
            initTableOfContents();
        });
    </script>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
        });
        
        // Look for mermaid divs that were generated by Pandoc Lua filter
        const mermaidDivs = document.querySelectorAll('div.mermaid');
        
        mermaidDivs.forEach((div) => {
            // Verify mermaid content is present
            if (div.textContent.trim()) {
                // Content is ready for rendering
            }
        });
        
        // Also look for any code.language-mermaid blocks (fallback for compatibility)
        const codeMermaidBlocks = document.querySelectorAll('code.language-mermaid');
        
        codeMermaidBlocks.forEach((code) => {
            code.classList.remove('language-mermaid');
            code.classList.add('mermaid');
            // If wrapped in pre, mark pre as mermaid too
            if (code.parentElement.tagName === 'PRE') {
                code.parentElement.classList.add('mermaid-block');
            }
        });
        
        // Wait for DOM to be fully loaded, then render all mermaid diagrams
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', async () => {
                try {
                    await mermaid.run();
                } catch (err) {
                    console.error('Mermaid rendering error:', err);
                }
            });
        } else {
            // Already loaded
            mermaid.run().catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }
    </script>
</body>
</html>
